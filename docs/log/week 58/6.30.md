## log

### [融云消息ID生成策略](http://www.52im.net/thread-2747-1-1.html)

> 融云消息数据的唯一 ID 长度采用 80 Bit

每 5 个 Bit ，进行一次 32 进制编码，转换为一个字符。80 Bit 可以转换为 16 个字符，再加上 3 个分隔符（ - ），将 16 个字符分为 4 组，最终得到一个 19 字符的唯一 ID ，形如：*`BD8U-FCOJ-LDC5-L789`*

80 Bit 被分为 4 段

1. **第一段 42 Bit：**用于存放时间戳，最长可表示到 2109 年
2. **第二段 12 Bit：**用于存放自旋转 ID 。自旋 ID 就是在给落到同一毫秒内的消息进行自增编号。12 Bit 则意味着，同一毫秒内，单台主机中最多可以标识 4096（ 2 的 12 次方）条消息。
3. **第三段 4   Bit：**用于标识会话类型。4 Bit ，最多可以标识 16 种会话。
4. **第四段 22 Bit：**会话 ID 。如群聊中的群 ID ，聊天室中的聊天室 ID 等。





### [美团Leaf-Segment](http://www.52im.net/thread-2751-1-1.html)

#### 基本原理

**数据库表设计如下：**



#### 双buffer优化



### [百度**UidGenerator**](https://github.com/baidu/uid-generator)

改进后的SnowFlake算法

**原版SnowFlake算法各字段的具体意义是：**

1. 1位sign标识位；
2. 41位时间戳；
3. 10位workId（即5位数据中心id+5位工作机器id）；
4. 12位自增序列。



**UidGenerator默认ID中各数据位的含义如下：**

1. *sign(1bit)：*固定1bit符号标识，即生成的UID为正数。
2. *delta seconds (28 bits)：*当前时间，相对于时间基点"2016-05-20"的增量值，单位：秒，最多可支持约8.7年（注意：(a)这里的单位是秒，而不是毫秒！ (b)注意这里的用词，是“最多”可支持8.7年，为什么是“最多”，后面会讲）。
3. *worker id (22 bits)：*机器id，最多可支持约420w次机器启动。内置实现为在启动时由数据库分配，默认分配策略为用后即弃，后续可提供复用策略。
4. *sequence (13 bits)：*每秒下的并发序列，13 bits可支持每秒8192个并发（注意下这个地方，默认支持qps最大为8192个）



### [**Tinyid**](http://www.52im.net/thread-3129-1-1.html)



## learn

### 每日一题



