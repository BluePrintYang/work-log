(window.webpackJsonp=window.webpackJsonp||[]).push([[223],{627:function(t,s,a){"use strict";a.r(s);var n=a(56),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"log"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#log"}},[t._v("#")]),t._v(" log")]),t._v(" "),a("h3",{attrs:{id:"个推绑定整改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#个推绑定整改"}},[t._v("#")]),t._v(" 个推绑定整改")]),t._v(" "),a("blockquote",[a("p",[t._v("在解绑个推别名时，客户端同时调用了今日校园服务端与个推服务端，由于调用顺序错误的原因，导致调用今日校园服务端接口时，存在失败的情况，因此今日校园数据库出现脏数据。")]),t._v(" "),a("p",[t._v("解决方案：将原先的客户端调两次解绑操作改为只调用今日校园服务端，而与个推解绑的操作也由今日校园服务端来实现")])]),t._v(" "),a("h3",{attrs:{id:"个推绑定-解绑操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#个推绑定-解绑操作"}},[t._v("#")]),t._v(" 个推绑定/解绑操作")]),t._v(" "),a("h4",{attrs:{id:"绑定"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#绑定"}},[t._v("#")]),t._v(" 绑定")]),t._v(" "),a("ol",[a("li",[t._v("登录或启动app")])]),t._v(" "),a("h4",{attrs:{id:"解绑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解绑"}},[t._v("#")]),t._v(" 解绑")]),t._v(" "),a("ol",[a("li",[t._v("删除校内身份（由于顺序问题，解绑接口失败）")]),t._v(" "),a("li",[t._v("退出账号")]),t._v(" "),a("li",[t._v("被踢下线 （解绑接口失败）")])]),t._v(" "),a("p",[a("strong",[t._v("切换身份，先解绑再绑定")])]),t._v(" "),a("h3",{attrs:{id:"整改思路"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整改思路"}},[t._v("#")]),t._v(" 整改思路")]),t._v(" "),a("h4",{attrs:{id:"绑定-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#绑定-2"}},[t._v("#")]),t._v(" 绑定")]),t._v(" "),a("blockquote",[a("ol",[a("li",[t._v("绑定前先检查是否有绑定此别名，如果有绑定则先解绑")]),t._v(" "),a("li",[t._v("今日校园绑定")]),t._v(" "),a("li",[t._v("个推绑定")])])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addGeTuiBind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GeTuiBindRequest")]),t._v(" geTuiBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Assert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasText")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("geTuiBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userId不能为空"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GeTuiBindPO")]),t._v(" geTuiBindPO "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mapperFacade"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("geTuiBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GeTuiBindPO")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    concurrentLinkedQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("geTuiBindPO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CompletableFuture")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("runAsync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("concurrentLinkedQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GeTuiBindPO")]),t._v(" poll "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" concurrentLinkedQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 绑定之前先查下是否有绑定此别名，如果有绑定则解绑")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" alias "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" poll"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAlias")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GeTuiBindPO")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" geTuiBindPOS "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" geTuiDao"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listByAlias")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Collections")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("singletonList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("alias"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CollectionUtils")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isNotEmpty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("geTuiBindPOS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 解绑时会把所有绑定的全部解绑，因此只需解绑一条即可")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GeTuiBindPO")]),t._v(" geTuiBindPO1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" geTuiBindPOS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GeTuiBindRequest")]),t._v(" geTuiUnBindRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GeTuiBindRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                geTuiUnBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUserId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("geTuiBindPO1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                geTuiUnBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("geTuiBindPO1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                geTuiUnBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAlias")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("alias"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("delGeTuiBind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("geTuiUnBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            geTuiDao"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addGeTuiBind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("poll"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调用个推 api 绑定别名")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CompletableFuture")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("runAsync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CpdailyUserBaseDTO")]),t._v(" userBaseByUserId "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" userConsumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserBaseByUserId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("geTuiBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Objects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isNull")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userBaseByUserId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CpdailyStringUtils")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isEmpty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userBaseByUserId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTenantId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" tenantId "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" userBaseByUserId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTenantId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"绑定个推别名，绑定信息:{}，租户id:{}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" geTuiBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tenantId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        pushComponent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bindGeTui")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("geTuiBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tenantId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4.25修改 这里有问题，两个都是异步操作，会导致刚绑定就被解绑，将上面的查询解绑操作取消异步")]),t._v("\n")])])]),a("h4",{attrs:{id:"解绑-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解绑-2"}},[t._v("#")]),t._v(" 解绑")]),t._v(" "),a("blockquote",[a("ol",[a("li",[t._v("解绑今日校园（原先通过用户id解绑，先改为通过别名解绑）")]),t._v(" "),a("li",[t._v("解绑个推")])])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("delGeTuiBind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GeTuiBindRequest")]),t._v(" geTuiBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Assert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasText")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("geTuiBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userId不能为空"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Assert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasText")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("geTuiBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAlias")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alias不能为空"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    geTuiDao"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("delByAlias")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("geTuiBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAlias")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调用个推 api 解绑别名")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CompletableFuture")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("runAsync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CpdailyUserBaseDTO")]),t._v(" userBaseByUserId "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" userConsumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserBaseByUserId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("geTuiBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Objects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isNull")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userBaseByUserId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CpdailyStringUtils")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isEmpty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userBaseByUserId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTenantId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" tenantId "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" userBaseByUserId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTenantId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"解绑个推别名，解绑信息:{}，租户id:{}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" geTuiBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tenantId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        pushComponent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("unbindGeTui")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("geTuiBindRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAlias")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tenantId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"场景1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#场景1"}},[t._v("#")]),t._v(" 场景1")]),t._v(" "),a("blockquote",[a("p",[t._v("个推与今日校园均不存在数据，调用绑定接口——对应用户登录今日校园")])]),t._v(" "),a("p",[a("strong",[t._v("结果")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 今日校园绑定成功，个推绑定成功，均存在一条数据 ✔️")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 今日校园数据 user_id,cid,alias")]),t._v("\n9fc9aedf-3f7a-4532-b5be-b4b2049edbd6,e3c5c0c250eb9a90d2af3af1ce8e56cf,ann2022\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 个推数据 alias cid")]),t._v("\nann2022\te3c5c0c250eb9a90d2af3af1ce8e56cf\n")])])]),a("h4",{attrs:{id:"场景2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#场景2"}},[t._v("#")]),t._v(" 场景2")]),t._v(" "),a("blockquote",[a("p",[t._v("重复绑定（再次执行场景1操作）—— 对应服务端与客户端同时调用个推绑定")]),t._v(" "),a("p",[t._v("结果与场景1相同 ✔️")])]),t._v(" "),a("h4",{attrs:{id:"场景3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#场景3"}},[t._v("#")]),t._v(" 场景3")]),t._v(" "),a("blockquote",[a("p",[t._v("仅更换cid（cid必须是客户端在个推初始化之后获取的cid，否则无效），调用绑定接口——对应用户换手机")])]),t._v(" "),a("p",[a("strong",[t._v("结果")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 今日校园绑定成功，个推绑定成功，均存在一条新数据 ✔️")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 今日校园数据 user_id,cid,alias")]),t._v("\n9fc9aedf-3f7a-4532-b5be-b4b2049edbd6,7d6482ee631fbfca865ddbc50236e8c8,ann2022\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 个推数据 alias cid")]),t._v("\nann2022\t7d6482ee631fbfca865ddbc50236e8c8\n")])])]),a("h4",{attrs:{id:"场景4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#场景4"}},[t._v("#")]),t._v(" 场景4")]),t._v(" "),a("blockquote",[a("p",[t._v("仅更改别名，调用绑定接口——对应多身份用户切身份")])]),t._v(" "),a("p",[t._v("结果")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 今日校园绑定成功，个推绑定成功，均存在一条新数据，旧别名数据消失 ✔️")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 今日校园数据 user_id,cid,alias")]),t._v("\n9fc9aedf-3f7a-4532-b5be-b4b2049edbd6,7d6482ee631fbfca865ddbc50236e8c8,ann202211\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 个推数据 alias cid")]),t._v("\nann202211\t7d6482ee631fbfca865ddbc50236e8c8\n")])])]),a("h4",{attrs:{id:"场景5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#场景5"}},[t._v("#")]),t._v(" 场景5")]),t._v(" "),a("blockquote",[a("p",[t._v("仅更改用户id，调用绑定接口——不存在此场景")])]),t._v(" "),a("p",[a("strong",[t._v("结果")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 今日校园两条数据，个推绑定存在一条数据 ❌")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 今日校园数据 user_id,cid,alias")]),t._v("\n00005830-049e-11e7-ab63-00163f0028bf,7d6482ee631fbfca865ddbc50236e8c8,ann202211\n9fc9aedf-3f7a-4532-b5be-b4b2049edbd6,7d6482ee631fbfca865ddbc50236e8c8,ann202211\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 个推数据 alias cid")]),t._v("\nann202211\t7d6482ee631fbfca865ddbc50236e8c8\n")])])]),a("p",[t._v("解决思路：数据库cid与alias建立唯一索引")]),t._v(" "),a("h4",{attrs:{id:"解绑-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解绑-3"}},[t._v("#")]),t._v(" 解绑")]),t._v(" "),a("blockquote",[a("p",[t._v("在场景5的情况下进行解绑")])]),t._v(" "),a("p",[t._v("结果")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 个推无数据，今日校园存在一条数据")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 今日校园数据 user_id,cid,alias")]),t._v("\n9fc9aedf-3f7a-4532-b5be-b4b2049edbd6,7d6482ee631fbfca865ddbc50236e8c8,ann202211\n")])])]),a("h4",{attrs:{id:"解绑场景2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解绑场景2"}},[t._v("#")]),t._v(" 解绑场景2")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 今日校园数据 user_id,cid,alias")]),t._v("\n1ed431d4-f863-4299-b96f-5a2989061c6a,2d1da640c7c5adcae46486ef46907657,ann358\na1bc2356-5b4e-473e-bb36-e403512c9356,61a379d4b7d24b55746d51c6486558a1,ann358\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 个推数据 alias cid")]),t._v("\nann358\t2abf85c201f89c68783b87207690cf8d\nann358\t077f3ba9ae44154fc0d79ffa1ade2de3\nann358\ta4a0b507f06ee2062d9eef35a0a0b22d\nann358\tc19a2faa872b80be4bcd2c31d61beefb\nann358\t2d1da640c7c5adcae46486ef46907657\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#解绑参数 cid alias user_id")]),t._v("\n2d1da640c7c5adcae46486ef46907657 ann358 1ed431d4-f863-4299-b96f-5a2989061c6a\n")])])]),a("p",[a("strong",[t._v("结果")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 个推无数据，今日校园存在一条数据")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 今日校园数据 user_id,cid,alias")]),t._v("\na1bc2356-5b4e-473e-bb36-e403512c9356,61a379d4b7d24b55746d51c6486558a1,ann358\n")])])]),a("h4",{attrs:{id:"修改解绑后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改解绑后"}},[t._v("#")]),t._v(" 修改解绑后")]),t._v(" "),a("blockquote",[a("p",[t._v("通过别名进行解绑，删除今日校园同一别名的所有数据")])]),t._v(" "),a("p",[a("strong",[t._v("结果")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 个推无数据，今日校园无数据")]),t._v("\n")])])]),a("h3",{attrs:{id:"其他问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他问题"}},[t._v("#")]),t._v(" 其他问题")]),t._v(" "),a("ol",[a("li",[t._v("同时有独立打包与今日校园通道租户")]),t._v(" "),a("li",[t._v("脏数据问题   —— 无需再去删数据，之后每次调用解绑接口会删除脏数据")]),t._v(" "),a("li",[t._v("异步失败问题")]),t._v(" "),a("li",[t._v("绑定前解绑问题   —— 切手机登录杀进程不会调用解绑接口")])]),t._v(" "),a("h2",{attrs:{id:"learn"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#learn"}},[t._v("#")]),t._v(" learn")]),t._v(" "),a("h3",{attrs:{id:"每日一题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#每日一题"}},[t._v("#")]),t._v(" 每日一题")]),t._v(" "),a("h4",{attrs:{id:"场景3-更改前"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#场景3-更改前"}},[t._v("#")]),t._v(" 场景3 （更改前）")]),t._v(" "),a("blockquote",[a("p",[t._v("仅更换cid（cid必须是客户端在个推初始化之后的cid，否则无效），调用绑定接口")])]),t._v(" "),a("p",[a("strong",[t._v("结果")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 今日校园绑定成功，存在一条新数据，个推绑定成功，存在两条数据\n# 今日校园数据 user_id,cid,alias\n9fc9aedf-3f7a-4532-b5be-b4b2049edbd6,7d6482ee631fbfca865ddbc50236e8c8,ann2022\n# 个推数据 alias cid\nann2022\te3c5c0c250eb9a90d2af3af1ce8e56cf\nann2022\t7d6482ee631fbfca865ddbc50236e8c8\n")])])]),a("p",[a("strong",[t._v("期望结果")])]),t._v(" "),a("p",[t._v("均为一条，解决方案，执行绑定操作先执行解绑")])])}),[],!1,null,null,null);s.default=e.exports}}]);